# 知识梳理

## 系统命令

### windows系统

msinfo32	系统信息

systeminfo	简单了解系统信息

net user 查看用户账户信息

msconfig	查看启动项信息

Get-ScheduledTask	查看当前系统中所有计划任务的信息

schtasks	获取任务计划的信息

netsh Firewall show state	查看防火墙信息

tasklist		查看计算机所有进程

netstat	显示网络连接的信息

wmic process	查询进程情况

services.msc	打开服务窗口 

forfiles	通过时间点查找文件









### linux系统

lscpu	查看CPU相关信息

uname -a	查看当前操作系统信息

lsmod	查看所有已载入系统的模块信息

cat /etc/passwd	查看所有用户信息

lastb	查看用户错误的登录信息

lastlog	查看系统中所有用户最后的登录信息

last	查看用户最近登录信息

who	查看当前用户登录系统情况

ls -alt /etc/init.d	查看init.d文件夹下所有文件的详细信息	

crontab -l	查看当前的任务信息

netstat	查询端口、ip、可疑端口、PID、进程

ls -alt /proc/PID	查看其对应的可执行程序

lsof -p PID	查看进程所打开的文件

chkconfig --list 查看系统运行的服务

service --status-all	查看所有服务的状态

/var/log	查看日志



## 常用工具

sysinternalsSuite



## 日志

eventvwr命令打开事件查看器

## 日志文件

系统日志：windows系统中的各个组件在运行中产生的各种事件

安全性日志：记录了各种与安全相关的事件

应用程序日志：记录各种应用程序所产生的各类事件



## 事件ID

4624	登录成功

4625	登录失败

4672	特殊权限用户登录

4720	创建用户

4728	添加用户到启动安全性的本地组中

4732	添加用户到启动安全性的全局组中

7045	服务创建

7030	服务创建失败



## 工具

FullEventLogView	日志检索工具

Event Log Explorer	检测系统安全的软件



## 勒索病毒

#### 常见的勒索病毒

wannacry勒索病毒

globeimposter勒索病毒

crysis勒索病毒

satan勒索病毒

stop勒索病毒



通过这次的实验，让我对应急响应的攻击还有防守都有了新的认识，将之前学过的对象实际操作了一遍，让我学到了以前一些没有注意到的东西，通过实践能够将这些查漏补缺。

#### 勒索病毒利用的常见漏洞

RDP协议弱密码暴力破解

win32提权漏洞

weblogic反序列化漏洞

apache struts远程代码执行漏洞



#### 传播途径

1、服务器入侵传播

通过系统或软件漏洞等方式入侵服务器，或通过RDP弱密码爆破远程登录服务器

2、利用漏洞自动传播

通过系统自身漏洞进行传播扩散

3、软件供应链攻击传播

4、邮件附件传播

5、利用挂马网页传播



#### 处置方法

1、判断主机类型，服务器还是个人终端

2、判断系统类型，windows还是linux

3、查看感染主机的台数，隔离被感染的主机/服务器

4、查看进程、启动项、注册表等查找文件所在位置

5、确定勒索病毒种类，进行溯源分析

6、查找处置方式，恢复数据和业务

7、后续防护建议



#### 后续防护建议

服务器、终端防护

1、所有服务器和终端实施复杂密码，杜绝弱密码

2、杜绝使用通用密码管理所有机器

3、按照杀毒软件、终端安全管理软件

4、及时安装补丁

5、服务器开启关键日志收集功能



网络防护和安全检测

1、对内网的安全域进行合理划分

2、在网络内架设IDS/IPS设备

3、在网络内假设全流量记录设备



#### 常用工具

勒索病毒查询工具

奇安信，360的勒索病毒搜索引擎

quick heal的勒索病毒解密工具



日志分析工具

观星实验室



## 挖矿木马

#### 传播方式

1、利用漏洞传播（如windows系统漏洞，中间件漏洞、web漏洞等）

2、通过弱密码暴力破解传播

3、通过僵尸网络传播

4、采用无文件工具方法传播

5、利用网页挂马传播

6、利用软件供应链工具传播

7、利用社交软件、邮件传播

8、内部人员私自安装和运行挖矿程序



#### 处置方法

1、确定主机类型（服务器、个人终端），系统类型windows

2、受感染资产是哪些

3、确定感染的数量，将感染的资产隔离

4、确定感染的时间，看系统日志是否异常，中间件日志，主机信息

5、看进程是否有异常，在windows

6、给安全建议（定期修改木马，打补丁，做好备份）



#### 挖矿木马防范

1、避免使用弱口令

2、及时打补丁

3、服务器定期维护

4、流量网页或者启动客户端时主要CPU/GPU的使用率

5、避免访问被标记为高风险的网站

6、避免下载来源不明的客户端和外挂等辅助软件



#### 常用工具

processexplore

进程管理工具，能管理隐藏在后台运行的程序

PCHunter	windows系统信息查看软件，手工杀毒软件

查看进程、网络连接、文件操作



## 系统排查

windows

1、检测用户信息

使用net users或者本地用户和组中查看是否存在可疑用户及隐藏用户

2、检测网络连接（445端口，会发送大量的445请求）、进程、服务、计划任务



linux

检测用户信息

cat /etc/passwd	查看心态所有用户信息

lastlog	所有用户最后登录信息

lastb		查看用户错误登录列表

last	查看用户最近登录信息

who	查看当前用户登录系统的情况

ps aux	查看进程

netstat -antp	查看进程、端口及对应的PID

